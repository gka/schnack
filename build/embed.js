!function(){"use strict";function n(n){var e,t={},r=n.split(y);if(k.test(r[0])?(t.date=null,e=r[0]):(t.date=r[0],e=r[1]),e){var a=I.exec(e);a?(t.time=e.replace(a[1],""),t.timezone=a[1]):t.time=e}return t}function e(n,e){var t,r=D[e],a=T[e];if(t=w.exec(n)||a.exec(n)){var o=t[1];return{year:parseInt(o,10),restDateString:n.slice(o.length)}}if(t=b.exec(n)||r.exec(n)){var s=t[1];return{year:100*parseInt(s,10),restDateString:n.slice(s.length)}}return{year:null}}function t(n,e){if(null===e)return null;var t,r,a,s;if(0===n.length)return(r=new Date(0)).setUTCFullYear(e),r;if(t=M.exec(n))return r=new Date(0),a=parseInt(t[1],10)-1,r.setUTCFullYear(e,a),r;if(t=S.exec(n)){r=new Date(0);var i=parseInt(t[1],10);return r.setUTCFullYear(e,0,i),r}if(t=x.exec(n)){r=new Date(0),a=parseInt(t[1],10)-1;var c=parseInt(t[2],10);return r.setUTCFullYear(e,a,c),r}return(t=Y.exec(n))?(s=parseInt(t[1],10)-1,o(e,s)):(t=E.exec(n))?o(e,s=parseInt(t[1],10)-1,parseInt(t[2],10)-1):null}function r(n){var e,t,r;if(e=H.exec(n))return(t=parseFloat(e[1].replace(",",".")))%24*p;if(e=F.exec(n))return t=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),t%24*p+r*g;if(e=L.exec(n)){t=parseInt(e[1],10),r=parseInt(e[2],10);var a=parseFloat(e[3].replace(",","."));return t%24*p+r*g+1e3*a}return null}function a(n){var e,t;return(e=C.exec(n))?0:(e=$.exec(n))?(t=60*parseInt(e[2],10),"+"===e[1]?-t:t):(e=_.exec(n))?(t=60*parseInt(e[2],10)+parseInt(e[3],10),"+"===e[1]?-t:t):0}function o(n,e,t){e=e||0,t=t||0;var r=new Date(0);r.setUTCFullYear(n,0,4);var a=7*e+t+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+a),r}function s(n){var e=n%100;if(e>20||e<10)switch(e%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"}function i(n,e,t){var r,a,o=n.match(t),s=o.length;for(r=0;r<s;r++)a=e[o[r]]||nn[o[r]],o[r]=a||c(o[r]);return function(n){for(var e="",t=0;t<s;t++)o[t]instanceof Function?e+=o[t](n,nn):e+=o[t];return e}}function c(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|]$/g,""):n.replace(/\\/g,"")}function u(n,e){e=e||"";var t=n>0?"-":"+",r=Math.abs(n),a=r%60;return t+l(Math.floor(r/60),2)+e+l(a,2)}function l(n,e){for(var t=Math.abs(n).toString();t.length<e;)t="0"+t;return t}function d(n){var e,t="";n.user?(t+="\n    ",n.user.admin&&(t+='\n    <div class="schnack-settings">\n        <button class="schnack-action" data-target="notification" data-class="setting" data-action="true">un</button>\n        <button class="schnack-action" data-target="notification" data-class="setting" data-action="false">mute notifications</button>\n    </div>\n    '),t+='\n<div class="schnack-login-status">\n    (signed in as <span class="schnack-user">@'+(null==(e=n.user.name)?"":e)+'</span> :: <a class="schnack-signout" href="#">sign out</a>)\n</div>\n<div class="schnack-above">\n    <div class="schnack-form">\n        <textarea class="schnack-body" placeholder="Post a comment. Markdown is supported!"></textarea>\n        <blockquote class="schnack-body" style="display:none"></blockquote>\n        <br>\n        <button class="schnack-preview">Preview</button>\n        <button style="display:none" class="schnack-write">Edit</button>&nbsp;\n        <button class="schnack-button">Send comment</button>&nbsp;\n        <button class="schnack-cancel-reply" style="display:none">Cancel</button>\n    </div>\n</div>\n'):(t+="\nTo post a comment you need to sign in via<br>\n",n.auth.forEach(function(n,r){t+="\n    "+(null==(e=r?" or ":"")?"":e)+'<button class="schnack-signin-'+(null==(e=n.id)?"":e)+'"><i class="icon schnack-icon-'+(null==(e=n.id)?"":e)+'"></i> '+(null==(e=n.name)?"":e)+"</button>\n"}),t+="\n"),t+="\n";var r=[];return n.replies={},n.comments.forEach(function(e){e.reply_to?(n.replies[e.reply_to]||(n.replies[e.reply_to]=[]),n.replies[e.reply_to].push(e)):r.push(e)}),n.comments=r,t+="\n"+(null==(e=n.comments_tpl(n))?"":e)+'\n<style type="text/css">\n.schnack-action > * { pointer-events: none; }\n</style>\n'}function f(n){var e,t="";return t+='<ul class="schnack-comments">\n    ',n.comments.forEach(function(r){t+='\n        <li id="comment-'+(null==(e=r.id)?"":e)+'" data-id="'+(null==(e=r.id)?"":e)+'" class="schnack-comment',r.approved||r.trusted||(t+=" schnack-not-approved"),t+='">\n            <div class="schnack-dateline">\n                <span class="schnack-author">',r.author_url&&(t+='<a href="'+(null==(e=r.author_url)?"":e)+'" target="_blank">'),t+=null==(e=r.display_name||r.name)?"":e,r.author_url&&(t+="</a>"),t+="</span>\n                ",n.user&&n.user.admin&&!r.trusted&&["trust","block"].forEach(function(n){t+='\n                <button class="schnack-action" data-target="'+(null==(e=r.user_id)?"":e)+'" data-class="user" data-action="'+(null==(e=n)?"":e)+'"><i class="icon schnack-icon-'+(null==(e=n)?"":e)+'"></i> <span>'+(null==(e=n)?"":e)+"</span></button>\n                "}),t+='\n                <span class="schnack-date"><a href="#comment-'+(null==(e=r.id)?"":e)+'">'+(null==(e=n.formatDate(r.created_at+"Z"))?"":e)+'</a></span>\n            </div>\n            <blockquote class="schnack-body">\n                '+(null==(e=r.comment)?"":e)+"\n            </blockquote>\n            ",r.approved||r.trusted?n.user&&(t+='\n            <button class="schnack-reply" data-reply-to="'+(null==(e=r.id)?"":e)+'">reply</button>\n            '):(t+='\n            <div class="schnack-awaiting-approval">\n                ',n.user&&n.user.admin&&["approve","reject"].forEach(function(n){t+='\n                <button class="schnack-action" data-target="'+(null==(e=r.id)?"":e)+'" data-class="comment" data-action="'+(null==(e=n)?"":e)+'"><i class="icon schnack-icon-'+(null==(e=n)?"":e)+'"></i> <span>'+(null==(e=n)?"":e)+"</span></button>\n                "}),t+="\n                "+(null==(e=n.user.admin?"This":"Your")?"":e)+" comment is still waiting for "+(null==(e=n.user.admin?"your ":"")?"":e)+"approval"+(null==(e=n.user.admin?"":" by the site owner")?"":e)+".\n            </div>\n            "),t+="\n            ",n.replies[r.id]&&(n.comments=n.replies[r.id],t+="\n            "+(null==(e=n.comments_tpl(n))?"":e)+"\n            "),t+="\n        </li>\n    "}),t+="\n</ul>\n"}var h="function"==typeof fetch?fetch.bind():function(n,e){return e=e||{},new Promise(function(t,r){function a(){var n,e=[],t=[],r={};return o.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(a,o,s){e.push(o=o.toLowerCase()),t.push([o,s]),n=r[o],r[o]=n?n+","+s:s}),{ok:1==(o.status/200|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:a,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return e},entries:function(){return t},get:function(n){return r[n.toLowerCase()]},has:function(n){return n.toLowerCase()in r}}}}var o=new XMLHttpRequest;o.open(e.method||"get",n);for(var s in e.headers)o.setRequestHeader(s,e.headers[s]);o.withCredentials="include"==e.credentials,o.onload=function(){t(a())},o.onerror=r,o.send(e.body)})},m=function(n){return n instanceof Date},p=36e5,g=6e4,v=2,y=/[T ]/,k=/:/,b=/^(\d{2})$/,D=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],w=/^(\d{4})/,T=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],M=/^-(\d{2})$/,S=/^-?(\d{3})$/,x=/^-?(\d{2})-?(\d{2})$/,Y=/^-?W(\d{2})$/,E=/^-?W(\d{2})-?(\d{1})$/,H=/^(\d{2}([.,]\d*)?)$/,F=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,L=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,I=/([Z+-].*)$/,C=/^(Z)$/,$=/^([+-])(\d{2})$/,_=/^([+-])(\d{2}):?(\d{2})$/,O=function(o,s){if(m(o))return new Date(o.getTime());if("string"!=typeof o)return new Date(o);var i=(s||{}).additionalDigits;i=null==i?v:Number(i);var c=n(o),u=e(c.date,i),l=u.year,d=t(u.restDateString,l);if(d){var f,h=d.getTime(),p=0;return c.time&&(p=r(c.time)),c.timezone?f=a(c.timezone):(f=new Date(h+p).getTimezoneOffset(),f=new Date(h+p+f*g).getTimezoneOffset()),new Date(h+p+f*g)}return new Date(o)},z=function(n){var e=O(n),t=new Date(0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t},j=function(n){var e=O(n);return e.setHours(0,0,0,0),e},W=6e4,q=864e5,A=function(n,e){var t=j(n),r=j(e),a=t.getTime()-t.getTimezoneOffset()*W,o=r.getTime()-r.getTimezoneOffset()*W;return Math.round((a-o)/q)},G=function(n){var e=O(n);return A(e,z(e))+1},P=function(n,e){var t=e?Number(e.weekStartsOn)||0:0,r=O(n),a=r.getDay(),o=(a<t?7:0)+a-t;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r},R=function(n){return P(n,{weekStartsOn:1})},U=function(n){var e=O(n),t=e.getFullYear(),r=new Date(0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);var a=R(r),o=new Date(0);o.setFullYear(t,0,4),o.setHours(0,0,0,0);var s=R(o);return e.getTime()>=a.getTime()?t+1:e.getTime()>=s.getTime()?t:t-1},X=function(n){var e=U(n),t=new Date(0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),R(t)},Z=6048e5,J=function(n){var e=O(n),t=R(e).getTime()-X(e).getTime();return Math.round(t/Z)+1},N=function(n){if(m(n))return!isNaN(n);throw new TypeError(toString.call(n)+" is not an instance of Date")},Q=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"],B=function(n){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(t);var r=Q.concat(e).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+r.join("|")+"|.)","g")},V=function(){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["January","February","March","April","May","June","July","August","September","October","November","December"],t=["Su","Mo","Tu","We","Th","Fr","Sa"],r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],i=["am","pm"],c=["a.m.","p.m."],u={MMM:function(e){return n[e.getMonth()]},MMMM:function(n){return e[n.getMonth()]},dd:function(n){return t[n.getDay()]},ddd:function(n){return r[n.getDay()]},dddd:function(n){return a[n.getDay()]},A:function(n){return n.getHours()/12>=1?o[1]:o[0]},a:function(n){return n.getHours()/12>=1?i[1]:i[0]},aa:function(n){return n.getHours()/12>=1?c[1]:c[0]}};return["M","D","DDD","d","Q","W"].forEach(function(n){u[n+"o"]=function(e,t){return s(t[n](e))}}),{formatters:u,formattingTokensRegExp:B(u)}},K={distanceInWords:function(){var n={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,t,r){r=r||{};var a;return a="string"==typeof n[e]?n[e]:1===t?n[e].one:n[e].other.replace("{{count}}",t),r.addSuffix?r.comparison>0?"in "+a:a+" ago":a}}}(),format:V()},nn={M:function(n){return n.getMonth()+1},MM:function(n){return l(n.getMonth()+1,2)},Q:function(n){return Math.ceil((n.getMonth()+1)/3)},D:function(n){return n.getDate()},DD:function(n){return l(n.getDate(),2)},DDD:function(n){return G(n)},DDDD:function(n){return l(G(n),3)},d:function(n){return n.getDay()},E:function(n){return n.getDay()||7},W:function(n){return J(n)},WW:function(n){return l(J(n),2)},YY:function(n){return l(n.getFullYear(),4).substr(2)},YYYY:function(n){return l(n.getFullYear(),4)},GG:function(n){return String(U(n)).substr(2)},GGGG:function(n){return U(n)},H:function(n){return n.getHours()},HH:function(n){return l(n.getHours(),2)},h:function(n){var e=n.getHours();return 0===e?12:e>12?e%12:e},hh:function(n){return l(nn.h(n),2)},m:function(n){return n.getMinutes()},mm:function(n){return l(n.getMinutes(),2)},s:function(n){return n.getSeconds()},ss:function(n){return l(n.getSeconds(),2)},S:function(n){return Math.floor(n.getMilliseconds()/100)},SS:function(n){return l(Math.floor(n.getMilliseconds()/10),2)},SSS:function(n){return l(n.getMilliseconds(),3)},Z:function(n){return u(n.getTimezoneOffset(),":")},ZZ:function(n){return u(n.getTimezoneOffset())},X:function(n){return Math.floor(n.getTime()/1e3)},x:function(n){return n.getTime()}},en=function(n,e,t){var r=e?String(e):"YYYY-MM-DDTHH:mm:ss.SSSZ",a=(t||{}).locale,o=K.format.formatters,s=K.format.formattingTokensRegExp;a&&a.format&&a.format.formatters&&(o=a.format.formatters,a.format.formattingTokensRegExp&&(s=a.format.formattingTokensRegExp));var c=O(n);return N(c)?i(r,o,s)(c):"Invalid Date"},tn=function(n){return document.querySelector(n)},rn=function(n){return document.querySelectorAll(n)},an=function(n){this.options=n,this.options.endpoint=n.host+"/comments/"+n.slug,this.initialized=!1,this.firstLoad=!0;var e=new URL(n.host);"localhost"!==e.hostname&&(document.domain=e.hostname.split(".").slice(1).join(".")),this.refresh()};an.prototype.refresh=function(){var n=this,e=this.options,t=e.target,r=e.slug,a=e.host,o=e.endpoint;h(o,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(e){e.comments_tpl=f,e.formatDate=function(e){return en(e,n.options.dateFormat)},tn(t).innerHTML=d(e);var s=tn(t+" div.schnack-above"),i=tn(t+" div.schnack-form"),c=tn(t+" textarea.schnack-body"),u=tn(t+" .schnack-form blockquote.schnack-body"),l=window.localStorage.getItem("schnack-draft-"+r);l&&c&&(c.value=l);var m=tn(t+" .schnack-button"),p=tn(t+" .schnack-preview"),g=tn(t+" .schnack-write"),v=tn(t+" .schnack-cancel-reply"),y=rn(t+" .schnack-reply");if(m&&(m.addEventListener("click",function(e){var t=c.value;h(o,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:t,replyTo:i.dataset.reply})}).then(function(n){return n.json()}).then(function(e){c.value="",window.localStorage.setItem("schnack-draft-"+r,c.value),e.id&&(n.firstLoad=!0,window.location.hash="#comment-"+e.id),n.refresh()})}),p.addEventListener("click",function(n){var e=c.value;c.style.display="none",p.style.display="none",u.style.display="block",g.style.display="inline",h(a+"/markdown",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:e})}).then(function(n){return n.json()}).then(function(n){u.innerHTML=n.html})}),g.addEventListener("click",function(n){c.style.display="inline",p.style.display="inline",u.style.display="none",g.style.display="none"}),c.addEventListener("keyup",function(){window.localStorage.setItem("schnack-draft-"+r,c.value)}),y.forEach(function(n){n.addEventListener("click",function(){i.dataset.reply=n.dataset.replyTo,v.style.display="inline-block",n.parentElement.appendChild(i)})}),v.addEventListener("click",function(){s.appendChild(i),delete i.dataset.reply,v.style.display="none"})),e.user){var k=tn("a.schnack-signout");k&&k.addEventListener("click",function(e){e.preventDefault(),h(a+"/signout",{credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(){return n.refresh()})})}else e.auth.forEach(function(e){var r=tn(t+" .schnack-signin-"+e.id);r&&r.addEventListener("click",function(t){var r=window.open(a+"/auth/"+e.id,e.name+" Sign-In","resizable,scrollbars,status,width=600,height=500");window.__schnack_wait_for_oauth=function(){r.close(),n.refresh()}})});if(e.user&&e.user.admin){if(!n.initialized){var b=document.createElement("script");b.setAttribute("src",a+"/push.js"),document.head.appendChild(b),n.initialized=!0}var D=function(e){var t=e.target.dataset;h(a+"/"+t.class+"/"+t.target+"/"+t.action,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:""}).then(function(){return n.refresh()})};document.querySelectorAll(".schnack-action").forEach(function(n){n.addEventListener("click",D)})}if(n.firstLoad&&window.location.hash.match(/^#comment-\d+$/)){var w=document.querySelector(window.location.hash);w.scrollIntoView(),w.classList.add("schnack-highlight"),n.firstLoad=!1}})},function(){var n=document.querySelector("script[data-schnack-target]");if(!n)return console.warn("schnack script tag needs some data attributes");var e=n.dataset,t=e.schnackSlug,r=e.dateFormat||"MMMM DD, YYYY - h:mm a",a=new URL(n.getAttribute("src")),o=a.protocol+"//"+a.host;new an({target:e.schnackTarget,slug:t,dateFormat:r,host:o})}()}();
